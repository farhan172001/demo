I will share you the S3Service and S3Service Test code, you have to modify S3ServiceTest according to S3Service and in file name you have .pdf and .txt so resolve that also in unit test, WRITE UNIT TEST CASES: CODE1 S3ServiceTest: @ExtendWith(MockitoExtension.class)

class S3ServiceTest {

@Mock 3 usages

private S3Client s3Client;

@Mock 1 usage

private S3Properties s3Properties;

@InjectMocks 4 usages

private S3Service s3Service;

private static final String BUCKET_NAME = "test-bucket"; 1 usage

private static final String FILE_NAME = ""; 3 usages

@Test

void testUploadFile_Success() throws Exception {

byte[] mockData = "sample content".getBytes();

I

PutObjectResponse expected PutObjectResponse = PutObjectResponse.builder().eTag(s: "123").build();

when (s3Properties.getBucketName()).thenReturn (BUCKET_NAME);

when(s3Client.putObject(any(PutObjectRequest.class), any (RequestBody.class)))

.thenReturn (expectedPutObjectResponse);

PutObjectResponse response = s3Service.uploadFile(FILE_NAME, mockData);PutObjectResponse response s3Service.uploadFile(FILE NAME, mockData);

assertEquals(expected: "123", response.eTag());

verify(s3Client, times(wantedNumberOfInvocations: 1))

putObject(any (PutObjectRequest.class), any (RequestBody.class));

@Test

void testUploadFile_EmptyFileName_Throws Exception() {

byte[] mockData = "sample content".getBytes();

assert Throws (S$30perationException.class, () -> s3Service, uploadFile(fileName: "", mockData));

@Test

void testUploadFile_EmptyContent_Throws Exception() {

assertThrows (S30perationException.class, ()-> s3Service.uploadFile(FILE NAME, new byte[0]));

}

@Test

void testUploadFile_AwsException_ThrowsWrappedException() throws Exception {

byte[] mockData "sample content".getBytes();

when(s3Client.putObject(any (PutObjectRequest.class), any (RequestBody.class))) then Throw (S3Exception.builder().message(s: "Aws error").build());assertThrows (S30perationException.class, () -> s3Service.uploadFile(FILE_NAME, mockData));}}. CODE2 S3service: @Service 30 usages

@RequiredArgsConstructor

public class S3Service {

private final S3Client s3Client;

private final S3Properties s3Properties;

public PutobjectResponse uploadFile(String fileName, byte[] content) throws S30perationException { 2 usages

if (fileName == null || fileName.isBlank()) {

AppLogger.error(this.getClass(), msg: "Filename cannot be null or empty");

throw new S30perationException("Filename cannot be null or empty", ExceptionType.TECHNICAL);

}

if (content == null || content.length == 0) {

}

AppLogger.error(this.getClass(), msg: "File content cannot be null or empty");

throw new $30perationException("File content cannot be null or empty", ExceptionType.TECHNICAL);

String contentType = resolveContentType(fileName);

try {

AppLogger.info(this.getClass(), msg: "Uploading file '{}' to S3 bucket '{}'", fileName, s3Properties.getBucketName());

return s3Client.putObject(PutObjectRequest.builder()

bucket(s3Properties.getBucketName())

.key(fileName).key(fileName)

.contentType(contentType)

.build(),

RequestBody.fromBytes(content));

} catch (AwsServiceException e) {

AppLogger.error(this.getClass(), msg: "Failed to upload the file {} to S3 bucket, Reason: {}", fileName, e.getMessage(), e);

throw new S30perationException("Failed to upload file to S3 bucket", e, ExceptionType.TECHNICAL);

}

}

@

public String resolveContentType(String fileName) throws $30perationException { 2 usages

String lower fileName.toLowerCase();

if (lower.endsWith(".pdf")) {

return PDF_CONTENT_TYPE;

}

if (lower.endsWith(".txt")) {

return TXT_CONTENT_TYPE;

}

throw new S30perationException(

);

m

"Unsupported file format. Only PDF and TXT files are allowed: + fileName, ExceptionType.TECHNICAL);}public byte[] downloadFile(String key) { 1 usage

ResponseBytes<GetObjectResponse> objectAsBytes =

s3Client.getObjectAsBytes(GetObjectRequest.builder()

.bucket (s3Properties.getBucketName())

}

.key(key)

.build());

return objectAsBytes.asByteArray();







@ExtendWith(MockitoExtension.class)
class S3ServiceTest {

    @Mock
    private S3Client s3Client;

    @Mock
    private S3Properties s3Properties;

    @InjectMocks
    private S3Service s3Service;

    private static final String BUCKET_NAME = "test-bucket";

    @BeforeEach
    void setup() {
        when(s3Properties.getBucketName()).thenReturn(BUCKET_NAME);
    }

    // -------------------------------
    // SUCCESS CASE
    // -------------------------------
    @Test
    void testUploadFile_Success_PDF() throws Exception {
        String fileName = "document.pdf";
        byte[] content = "sample content".getBytes();

        PutObjectResponse expected = PutObjectResponse.builder()
                .eTag("123")
                .build();

        when(s3Client.putObject(any(PutObjectRequest.class), any(RequestBody.class)))
                .thenReturn(expected);

        PutObjectResponse response = s3Service.uploadFile(fileName, content);

        assertEquals("123", response.eTag());
        verify(s3Client, times(1))
                .putObject(any(PutObjectRequest.class), any(RequestBody.class));
    }

    @Test
    void testUploadFile_Success_TXT() throws Exception {
        String fileName = "notes.txt";
        byte[] content = "hello".getBytes();

        PutObjectResponse expected = PutObjectResponse.builder()
                .eTag("999")
                .build();

        when(s3Client.putObject(any(PutObjectRequest.class), any(RequestBody.class)))
                .thenReturn(expected);

        PutObjectResponse response = s3Service.uploadFile(fileName, content);

        assertEquals("999", response.eTag());
    }

    // -------------------------------
    // FAILURE CASES
    // -------------------------------
    @Test
    void testUploadFile_EmptyFileName_ThrowsException() {
        byte[] content = "abc".getBytes();

        assertThrows(
                S3OperationException.class,
                () -> s3Service.uploadFile("", content)
        );
    }

    @Test
    void testUploadFile_EmptyContent_ThrowsException() {
        assertThrows(
                S3OperationException.class,
                () -> s3Service.uploadFile("file.pdf", new byte[0])
        );
    }

    @Test
    void testUploadFile_UnsupportedExtension_ThrowsException() {
        byte[] content = "data".getBytes();

        assertThrows(
                S3OperationException.class,
                () -> s3Service.uploadFile("image.jpg", content)
        );
    }

    @Test
    void testUploadFile_AwsException_ThrowsWrappedException() {
        String fileName = "doc.pdf";
        byte[] content = "test".getBytes();

        when(s3Client.putObject(any(PutObjectRequest.class), any(RequestBody.class)))
                .thenThrow(S3Exception.builder().message("AWS Error").build());

        assertThrows(
                S3OperationException.class,
                () -> s3Service.uploadFile(fileName, content)
        );
    }

    // -------------------------------
    // CONTENT-TYPE TESTING
    // -------------------------------
    @Test
    void testResolveContentType_PDF() throws Exception {
        assertEquals("application/pdf", s3Service.resolveContentType("test.PDF"));
    }

    @Test
    void testResolveContentType_TXT() throws Exception {
        assertEquals("text/plain", s3Service.resolveContentType("data.TXT"));
    }

    @Test
    void testResolveContentType_Unsupported_ThrowsException() {
        assertThrows(
                S3OperationException.class,
                () -> s3Service.resolveContentType("photo.jpeg")
        );
    }

    // -------------------------------
    // DOWNLOAD FILE
    // -------------------------------
    @Test
    void testDownloadFile_Success() {
        String key = "test.pdf";
        byte[] mockContent = "downloaded".getBytes();

        ResponseBytes<GetObjectResponse> responseBytes =
                ResponseBytes.fromByteArray(GetObjectResponse.builder().build(), mockContent);

        when(s3Client.getObjectAsBytes(any(GetObjectRequest.class)))
                .thenReturn(responseBytes);

        byte[] result = s3Service.downloadFile(key);

        assertArrayEquals(mockContent, result);
        verify(s3Client, times(1)).getObjectAsBytes(any(GetObjectRequest.class));
    }
}








@ExtendWith(MockitoExtension.class)
class S3ServiceTest {

    @Mock
    private S3Client s3Client;

    @Mock
    private S3Properties s3Properties;

    @InjectMocks
    private S3Service s3Service;

    private static final String BUCKET_NAME = "test-bucket";

    @BeforeEach
    void setup() {
        when(s3Properties.getBucketName()).thenReturn(BUCKET_NAME);
    }

    // -----------------------------------------------------------
    @Test
    void testUploadFile_Success_PdfContentType() throws Exception {
        byte[] mockData = "sample content".getBytes();
        String fileName = "document.pdf";

        PutObjectResponse expectedPutObjectResponse =
                PutObjectResponse.builder().eTag("123").build();

        when(s3Client.putObject(any(PutObjectRequest.class), any(RequestBody.class)))
                .thenReturn(expectedPutObjectResponse);

        PutObjectResponse response = s3Service.uploadFile(fileName, mockData);

        assertEquals("123", response.eTag());

        ArgumentCaptor<PutObjectRequest> requestCaptor =
                ArgumentCaptor.forClass(PutObjectRequest.class);

        verify(s3Client, times(1))
                .putObject(requestCaptor.capture(), any(RequestBody.class));

        PutObjectRequest actualRequest = requestCaptor.getValue();

        assertEquals(BUCKET_NAME, actualRequest.bucket());
        assertEquals(fileName, actualRequest.key());
        assertEquals(S3Service.PDF_CONTENT_TYPE, actualRequest.contentType());
    }

    // -----------------------------------------------------------
    @Test
    void testUploadFile_Success_TxtContentType() throws Exception {
        byte[] mockData = "text content".getBytes();
        String fileName = "notes.txt";

        PutObjectResponse expectedPutObjectResponse =
                PutObjectResponse.builder().eTag("etag-456").build();

        when(s3Client.putObject(any(PutObjectRequest.class), any(RequestBody.class)))
                .thenReturn(expectedPutObjectResponse);

        PutObjectResponse response = s3Service.uploadFile(fileName, mockData);
        assertEquals("etag-456", response.eTag());

        ArgumentCaptor<PutObjectRequest> requestCaptor =
                ArgumentCaptor.forClass(PutObjectRequest.class);

        verify(s3Client, times(1))
                .putObject(requestCaptor.capture(), any(RequestBody.class));

        PutObjectRequest actualRequest = requestCaptor.getValue();

        assertEquals(BUCKET_NAME, actualRequest.bucket());
        assertEquals(fileName, actualRequest.key());
        assertEquals(S3Service.TXT_CONTENT_TYPE, actualRequest.contentType());
    }

    // -----------------------------------------------------------
    @Test
    void testUploadFile_EmptyFileName_ThrowsException() {
        byte[] mockData = "sample content".getBytes();

        S3OperationException ex = assertThrows(
                S3OperationException.class,
                () -> s3Service.uploadFile("", mockData)
        );

        assertTrue(ex.getMessage().toLowerCase().contains("filename"));
    }

    // -----------------------------------------------------------
    @Test
    void testUploadFile_NullFileName_ThrowsException() {
        byte[] mockData = "sample content".getBytes();

        S3OperationException ex = assertThrows(
                S3OperationException.class,
                () -> s3Service.uploadFile(null, mockData)
        );

        assertTrue(ex.getMessage().toLowerCase().contains("filename"));
    }

    // -----------------------------------------------------------
    @Test
    void testUploadFile_EmptyContent_ThrowsException() {
        S3OperationException ex = assertThrows(
                S3OperationException.class,
                () -> s3Service.uploadFile("file.txt", new byte[0])
        );

        assertTrue(ex.getMessage().toLowerCase().contains("content"));
    }

    // -----------------------------------------------------------
    @Test
    void testUploadFile_NullContent_ThrowsException() {

        S3OperationException ex = assertThrows(
                S3OperationException.class,
                () -> s3Service.uploadFile("file.pdf", null)
        );

        assertTrue(ex.getMessage().toLowerCase().contains("content"));
    }

    // -----------------------------------------------------------
    @Test
    void testUploadFile_AwsException_ThrowsWrappedException() {

        byte[] mockData = "sample content".getBytes();
        String fileName = "document.pdf";

        when(s3Client.putObject(any(PutObjectRequest.class), any(RequestBody.class)))
                .thenThrow(AwsServiceException.builder().message("Aws error").build());

        S3OperationException ex = assertThrows(
                S3OperationException.class,
                () -> s3Service.uploadFile(fileName, mockData)
        );

        assertTrue(ex.getMessage().toLowerCase().contains("failed to upload"));
    }

    // -----------------------------------------------------------
    @Test
    void testResolveContentType_Pdf() throws Exception {
        String contentType = s3Service.resolveContentType("file.PDF");
        assertEquals(S3Service.PDF_CONTENT_TYPE, contentType);
    }

    // -----------------------------------------------------------
    @Test
    void testResolveContentType_Txt() throws Exception {
        String contentType = s3Service.resolveContentType("readme.txt");
        assertEquals(S3Service.TXT_CONTENT_TYPE, contentType);
    }

    // -----------------------------------------------------------
    @Test
    void testResolveContentType_Unsupported_ThrowsException() {

        S3OperationException ex = assertThrows(
                S3OperationException.class,
                () -> s3Service.resolveContentType("image.png")
        );

        assertTrue(ex.getMessage().toLowerCase().contains("unsupported file format"));
    }

    // -----------------------------------------------------------
    @Test
    void testDownloadFile_Success() {

        String key = "path/to/file.txt";
        byte[] expectedBytes = "downloaded".getBytes();

        ResponseBytes<GetObjectResponse> responseBytes =
                ResponseBytes.fromByteArray(
                        GetObjectResponse.builder().build(),
                        expectedBytes
                );

        when(s3Client.getObjectAsBytes(any(GetObjectRequest.class)))
                .thenReturn(responseBytes);

        byte[] actual = s3Service.downloadFile(key);
        assertArrayEquals(expectedBytes, actual);

        ArgumentCaptor<GetObjectRequest> getCaptor =
                ArgumentCaptor.forClass(GetObjectRequest.class);

        verify(s3Client, times(1))
                .getObjectAsBytes(getCaptor.capture());

        GetObjectRequest getReq = getCaptor.getValue();

        assertEquals(BUCKET_NAME, getReq.bucket());
        assertEquals(key, getReq.key());
    }
}

















Using this 1st to convert bsse64 to pdf so need to write unit test this also write? And 2nd fileto mapping txt to model class: write unit test for both: code1: Component 2 usages

public class FileConversionUtil {

public byte[] convertBase64ToPdf (String base64, String fileName) throws ApplicationException { I

try {

return Base64.getDecoder().decode(base64);

catch (Exception e) {

throw new ApplicationException(

"Failed to convert Base64 for file: " fileName,

ExceptionType.TECHNICAL

);}}} code2: Component 2 usages

public class MetadataParserütil {

public MetadataModel parseTxtToMetadata (String txtContent, String fileName) throws try 4

ApplicationExceptio

Retadatalodel.MetadataModelBuilder builder MetadataModel.builder();

String[] lines txtContent.split(regax: "[;\n]");

for (String rawLine: lines) {

String line ranLine.trim();

if (line.isEmpty()) continue;

String key getkey (Line);

String value getValue(Line);

if (key == null || value == null) continue;

switch (key.toLowerCase()) {

case "clainnumber":

builder.claimNumber(value); break;

case "certificatenumber":case "certificatenumber":

builder.certificateNumber(value);

break;

case "grpupnumber":

builder.groupNumber(value);

break;

case "corrtransactionid":

builder.corrTransactionId (value);

break;

case "corrsubtransactionid":

builder.corrSubTransactionId(value);

break;

case "eventname":

builder.eventName (value);

break;

case "disbursementid":

builder.disbursementId(value);}

case "disbursementid":

builder.disbursementId (value);

break;case "documentclass":

builder.documentClass (value);

break;

case "objectstore":

builder.objectStore (value);

break;

case "acc":

builder.acc(value);

break;

I

case "title":

builder.title(value);

break;

default:

break;}}MetadataModel metadata builder.build();

if (metadata.getGroupNumber() == null || metadata.getCorrTransactionId() == null) {

throw new ApplicationException(

"Metadata TXT missing required fields in file: fileName, null,

ExceptionType.TECHNICAL

);

}

return metadata;

catch (ApplicationException e) {

throw e;

} catch (Exception e) {

throw new ApplicationException(

"Failed to parse metadata TXT file: e, fileName,

ExceptionType.TECHNICAL;

}

}

private String getKey (String line) { 1 usage

String[] parts line.split(regex: "", limit: 2);

return parts.length > 0 ? parts[0].trim(): null;

}

private String getValue(String line) { 1 usage

String[] parts = line.split(regex: ",", limit: 2);

return parts.length > 1? parts [1].trim(): null; I

}.










code1: import org.junit.jupiter.api.Test;
import static org.junit.jupiter.api.Assertions.*;

class FileConversionUtilTest {

    private final FileConversionUtil util = new FileConversionUtil();

    @Test
    void testConvertBase64ToPdf_Success() throws Exception {
        // Base64 of: "Hello PDF"
        String base64 = Base64.getEncoder().encodeToString("Hello PDF".getBytes());

        byte[] result = util.convertBase64ToPdf(base64, "test.pdf");

        assertNotNull(result);
        assertArrayEquals("Hello PDF".getBytes(), result);
    }

    @Test
    void testConvertBase64ToPdf_InvalidBase64_ThrowsException() {
        String invalidBase64 = "### invalid ###";

        ApplicationException ex = assertThrows(
            ApplicationException.class,
            () -> util.convertBase64ToPdf(invalidBase64, "bad.pdf")
        );

        assertTrue(ex.getMessage().contains("Failed to convert Base64"));
    }

    @Test
    void testConvertBase64ToPdf_NullBase64_ThrowsException() {
        ApplicationException ex = assertThrows(
            ApplicationException.class,
            () -> util.convertBase64ToPdf(null, "null.pdf")
        );

        assertTrue(ex.getMessage().contains("Failed to convert Base64"));
    }
}






code2: import org.junit.jupiter.api.Test;
import static org.junit.jupiter.api.Assertions.*;

class MetadataParserUtilTest {

    private final MetadataParserUtil util = new MetadataParserUtil();

    @Test
    void testParseTxtToMetadata_Success() throws Exception {
        String txt =
                "claimNumber:123\n" +
                "certificateNumber:ABC\n" +
                "groupNumber:G001\n" +
                "corrTransactionId:TXN99\n" +
                "title:Test Document";

        MetadataModel metadata = util.parseTxtToMetadata(txt, "meta.txt");

        assertEquals("123", metadata.getClaimNumber());
        assertEquals("ABC", metadata.getCertificateNumber());
        assertEquals("G001", metadata.getGroupNumber());
        assertEquals("TXN99", metadata.getCorrTransactionId());
        assertEquals("Test Document", metadata.getTitle());
    }

    @Test
    void testParseTxtToMetadata_MissingRequiredFields_ThrowsException() {
        String txt =
                "claimNumber:999\n" +
                "certificateNumber:KKK\n";
        // Missing: groupNumber + corrTransactionId

        ApplicationException ex = assertThrows(
                ApplicationException.class,
                () -> util.parseTxtToMetadata(txt, "bad.txt")
        );

        assertTrue(ex.getMessage().contains("Metadata TXT missing required fields"));
    }

    @Test
    void testParseTxtToMetadata_UnsupportedFormat_SkipLines() throws Exception {
        String txt =
                "invalidline\n" +             // no key:value → ignored
                "claimNumber:123\n" +
                "groupNumber:G001\n" +
                "corrTransactionId:ABC";

        MetadataModel metadata = util.parseTxtToMetadata(txt, "test.txt");

        assertEquals("123", metadata.getClaimNumber());
        assertEquals("G001", metadata.getGroupNumber());
        assertEquals("ABC", metadata.getCorrTransactionId());
    }

    @Test
    void testParseTxtToMetadata_ThrowsWrappedException() {
        // Force split error or similar
        String txt = null;

        ApplicationException ex = assertThrows(
                ApplicationException.class,
                () -> util.parseTxtToMetadata(txt, "meta.txt")
        );

        assertTrue(ex.getMessage().contains("Failed to parse metadata TXT file"));
    }
}






correct code1: import org.junit.jupiter.api.Test;
import static org.junit.jupiter.api.Assertions.*;
import java.util.Base64;

class FileConversionUtilTest {

    private final FileConversionUtil util = new FileConversionUtil();

    @Test
    void testConvertBase64ToPdf_Success() throws Exception {
        String base64 = Base64.getEncoder().encodeToString("Hello PDF".getBytes());

        byte[] result = util.convertBase64ToPdf(base64, "test.pdf");

        assertNotNull(result);
        assertArrayEquals("Hello PDF".getBytes(), result);
    }

    @Test
    void testConvertBase64ToPdf_InvalidBase64_ThrowsException() {
        String invalidBase64 = "### invalid ###";

        ApplicationException ex = assertThrows(
                ApplicationException.class,
                () -> util.convertBase64ToPdf(invalidBase64, "bad.pdf")
        );

        assertTrue(ex.getMessage().toLowerCase().contains("failed to convert base64"));
    }

    @Test
    void testConvertBase64ToPdf_NullBase64_ThrowsException() {

        ApplicationException ex = assertThrows(
                ApplicationException.class,
                () -> util.convertBase64ToPdf(null, "null.pdf")
        );

        assertTrue(ex.getMessage().toLowerCase().contains("failed"));
    }

    @Test
    void testConvertBase64ToPdf_EmptyString_ReturnsEmptyBytes() throws Exception {

        byte[] result = util.convertBase64ToPdf("", "empty.pdf");

        assertNotNull(result);
        assertEquals(0, result.length);
    }
}




package com.aflac.eib.extream.content.util;

import com.aflac.eib.extream.content.exception.ApplicationException;
import com.aflac.eib.extream.content.model.MetadataModel;
import org.junit.jupiter.api.Test;
import static org.junit.jupiter.api.Assertions.*;

class MetadataParserUtilTest {

    private final MetadataParserUtil parser = new MetadataParserUtil();

    @Test
    void testParseTxtToMetadata_Success() throws Exception {

        String txt =
                "claimNumber: CLM123\n" +
                "certificateNumber: CERT456\n" +
                "groupNumber: GRP789\n" +
                "corrTransactionId: TID111\n" +
                "corrSubTransactionId: STID222\n" +
                "eventName: EVT\n" +
                "disbursementId: DISB\n" +
                "documentClass: DOC\n" +
                "objectStore: STORE\n" +
                "acc: ACC001\n" +
                "title: Sample Title";

        MetadataModel result = parser.parseTxtToMetadata(txt, "sample.txt");

        assertEquals("CLM123", result.getClaimNumber());
        assertEquals("CERT456", result.getCertificateNumber());
        assertEquals("GRP789", result.getGroupNumber());
        assertEquals("TID111", result.getCorrTransactionId());
        assertEquals("STID222", result.getCorrSubTransactionId());
        assertEquals("EVT", result.getEventName());
        assertEquals("DISB", result.getDisbursementId());
        assertEquals("DOC", result.getDocumentClass());
        assertEquals("STORE", result.getObjectStore());
        assertEquals("ACC001", result.getAcc());
        assertEquals("Sample Title", result.getTitle());
    }

    @Test
    void testParseTxtToMetadata_MissingRequiredFields_ShouldThrowException() {

        String txt =
                "claimNumber: CLM123\n" +
                "certificateNumber: CERT456";

        ApplicationException ex = assertThrows(
                ApplicationException.class,
                () -> parser.parseTxtToMetadata(txt, "invalid.txt")
        );

        assertTrue(ex.getMessage().contains("Metadata TXT missing required fields"));
    }

    @Test
    void testParseTxtToMetadata_InvalidLineFormat_IgnoredSafely() throws Exception {

        String txt =
                "claimNumber: CLM123\n" +
                "groupNumber: GRP789\n" +
                "corrTransactionId: TID123\n" +
                "InvalidLineWithoutColon\n";

        MetadataModel result = parser.parseTxtToMetadata(txt, "file.txt");

        assertEquals("GRP789", result.getGroupNumber());
        assertEquals("TID123", result.getCorrTransactionId());
        assertEquals("CLM123", result.getClaimNumber());
    }

    @Test
    void testParseTxtToMetadata_ExceptionHandling() {

        // this will cause NullPointer / unexpected exception inside parser
        String txt = null;

        ApplicationException ex = assertThrows(
                ApplicationException.class,
                () -> parser.parseTxtToMetadata(txt, "error.txt")
        );

        assertTrue(ex.getMessage().contains("Failed to parse metadata TXT file"));
    }
}







package com.aflac.eib.extream.content.util;

import com.aflac.eib.extream.content.exception.ApplicationException;
import com.aflac.eib.extream.content.model.MetadataModel;
import org.junit.jupiter.api.Test;
import static org.junit.jupiter.api.Assertions.*;

class MetadataParserUtilTest {

    private final MetadataParserUtil parser = new MetadataParserUtil();

    @Test
    void testParseTxtToMetadata_Success() throws Exception {

        String txt =
                "claimNumber, CLM123; " +
                "certificateNumber, CERT456; " +
                "groupNumber, GRP789; " +
                "corrTransactionId, TID111; " +
                "corrSubTransactionId, STID222; " +
                "eventName, EVT; " +
                "disbursementId, DISB; " +
                "documentClass, DOC; " +
                "objectStore, STORE; " +
                "acc, ACC001; " +
                "title, Sample Title";

        MetadataModel result = parser.parseTxtToMetadata(txt, "sample.txt");

        assertEquals("CLM123", result.getClaimNumber());
        assertEquals("CERT456", result.getCertificateNumber());
        assertEquals("GRP789", result.getGroupNumber());
        assertEquals("TID111", result.getCorrTransactionId());
        assertEquals("STID222", result.getCorrSubTransactionId());
        assertEquals("EVT", result.getEventName());
        assertEquals("DISB", result.getDisbursementId());
        assertEquals("DOC", result.getDocumentClass());
        assertEquals("STORE", result.getObjectStore());
        assertEquals("ACC001", result.getAcc());
        assertEquals("Sample Title", result.getTitle());
    }

    @Test
    void testParseTxtToMetadata_MissingRequiredFields_ShouldThrowException() {

        String txt =
                "claimNumber, CLM123; " +
                "certificateNumber, CERT456"; // missing groupNumber and corrTransactionId

        ApplicationException ex = assertThrows(
                ApplicationException.class,
                () -> parser.parseTxtToMetadata(txt, "invalid.txt")
        );

        assertTrue(ex.getMessage().contains("Metadata TXT missing required fields"));
    }

    @Test
    void testParseTxtToMetadata_InvalidLineFormat_IgnoredSafely() throws Exception {

        String txt =
                "claimNumber, CLM123; " +
                "groupNumber, GRP789; " +
                "corrTransactionId, TID123; " +
                "InvalidLineWithoutComma";

        MetadataModel result = parser.parseTxtToMetadata(txt, "file.txt");

        assertEquals("GRP789", result.getGroupNumber());
        assertEquals("TID123", result.getCorrTransactionId());
        assertEquals("CLM123", result.getClaimNumber());
    }

    @Test
    void testParseTxtToMetadata_ExceptionHandling() {

        // this will cause NullPointer / unexpected exception inside parser
        String txt = null;

        ApplicationException ex = assertThrows(
                ApplicationException.class,
                () -> parser.parseTxtToMetadata(txt, "error.txt")
        );

        assertTrue(ex.getMessage().contains("Failed to parse metadata TXT file"));
    }
}
